<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <title>Wine Diary</title>
    
    <!-- üì± Apple Touch Icon: Updated Notion Style (Improved Bottleneck) -->
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 180 180%22><rect width=%22180%22 height=%22180%22 fill=%22white%22/><g fill=%22none%22 stroke=%22%2337352F%22 stroke-width=%226%22 stroke-linecap=%22round%22 stroke-linejoin=%22round%22 transform=%22translate(40, 35)%22><path d=%22M25 110 H65 V55 L55 45 V10 H35 V45 L25 55 Z%22/><path d=%22M75 70 A15 15 0 0 1 105 70 L105 80 A15 15 0 0 1 75 80 Z%22/><path d=%22M90 80 L90 105 M80 105 L100 105%22/></g></svg>">
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        body {
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, Roboto, sans-serif !important;
            background-color: #FFFFFF;
            color: #37352F;
            -webkit-font-smoothing: antialiased;
            -webkit-user-select: none;
            user-select: none;
            margin: 0;
            overflow-x: hidden;
        }
        
        input, textarea, [contenteditable="true"] {
            -webkit-user-select: text !important;
            user-select: text !important;
            -webkit-touch-callout: default !important;
        }

        h1, h2, h3, h4, p, span, div, input, textarea, button {
            font-family: 'Pretendard', sans-serif !important;
            letter-spacing: -0.01em;
        }

        .notion-block {
            border: 1px solid #EDECE9;
            border-radius: 14px;
            background: white;
            transition: all 0.15s ease;
            box-shadow: 0 1px 3px rgba(0,0,0,0.02);
        }

        .notion-block:active { background: #F1F1EF; transform: scale(0.99); }

        .notion-input {
            width: 100%;
            padding: 14px;
            border: 1px solid #EDECE9;
            border-radius: 10px;
            background: #F7F7F5;
            outline: none;
            font-size: 16px;
            color: #37352F;
            appearance: none;
        }

        .notion-input:focus { border-color: #2383E2; background: white; box-shadow: inset 0 0 0 1px #2383E2; }
        
        .main-content {
            padding-bottom: 160px; 
        }

        .loader {
            width: 28px;
            height: 28px;
            border: 3px solid #F1F1EF;
            border-top: 3px solid #37352F;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.4);
            backdrop-filter: blur(4px);
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 24px;
        }

        .bottom-nav-mask {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 120px;
            background: white;
            z-index: 40;
            pointer-events: none;
        }

        #root { min-height: 100vh; }

        .icon-box { display: flex; align-items: center; justify-content: center; flex-shrink: 0; user-select: none; }
        .icon-svg { width: 100%; height: 100%; stroke: currentColor; fill: none; stroke-width: 2; stroke-linecap: round; stroke-linejoin: round; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        // --- Configuration ---
        const apiKey = ""; 
        const modelName = "gemini-2.5-flash"; 

        // --- Constants ---
        const WINE_TYPES = ["Red", "White", "Rose", "Sparkling"];
        const COLOR_MAP = {
            "White": ["Lemon", "Gold", "Amber"],
            "Red": ["Purple", "Ruby", "Garnet"],
            "Rose": ["Pink", "Salmon", "Onion Skin"],
            "Sparkling": ["Pale Gold", "Deep Gold"]
        };
        const AROMA_CATEGORIES = {
            "Fruit": ["Citrus", "Peach/Apricot", "Strawberry", "Cherry", "Blackberry", "Blueberry", "Pineapple"],
            "Floral & Herbal": ["Acacia", "Rose", "Fresh Grass", "Mint", "Lavender"],
            "Tertiary & Oak": ["Vanilla", "Toast", "Chocolate", "Coffee", "Leather", "Earth", "Smoke", "Nutty"]
        };
        const STRUCTURE_CONFIG = [
            { id: "sweetness", label: "Sweetness", levels: ["Dry", "Off-Dry", "Sweet"] },
            { id: "acidity", label: "Acidity", levels: ["Low", "Medium", "High"] },
            { id: "tannin", label: "Tannin", levels: ["Soft", "Firm", "Harsh"] },
            { id: "body", label: "Body", levels: ["Light", "Medium", "Full"] },
            { id: "finish", label: "Finish", levels: ["Short", "Medium", "Long"] }
        ];

        // ‚úÖ ‚ú® Updated Notion Style Icon Component with Improved Bottleneck
        const NotionIcon = ({ name, size = 24, className = "" }) => {
            const icons = {
                home: <path d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />,
                archive: <><rect x="3" y="4" width="18" height="18" rx="2" /><path d="M3 10h18M9 14h6" /></>,
                add: <path d="M12 5v14M5 12h14" />,
                // ‚úÖ ÏôÄÏù∏ ÏïÑÏù¥ÏΩò Ïã§Î£®Ïó£ Î≥¥Ï†ï (Î≥ëÎ™© Ï∂îÍ∞Ä)
                wine: <><path d="M5 18 H13 V9 L11 7 V2 H7 V7 L5 9 Z" transform="translate(0, 2)" /><path d="M15 10 A3 3 0 0 1 21 10 L21 12 A3 3 0 0 1 15 12 Z M18 12 V18 M16 18 H20" transform="translate(0, 2)" /></>,
                camera: <><path d="M23 19a2 2 0 01-2 2H3a2 2 0 01-2-2V8a2 2 0 012-2h4l2-3h6l2 3h4a2 2 0 012 2z" /><circle cx="12" cy="13" r="4" /></>,
                search: <><circle cx="11" cy="11" r="8" /><path d="M21 21l-4.35-4.35" /></>,
                history: <><path d="M12 8v4l3 3" /><circle cx="12" cy="12" r="9" /></>,
                book: <><path d="M4 19.5A2.5 2.5 0 016.5 17H20" /><path d="M6.5 2H20v20H6.5A2.5 2.5 0 014 19.5v-15A2.5 2.5 0 016.5 2z" /></>,
                star: <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z" />,
                edit: <path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z" />,
                delete: <><path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2M10 11v6M14 11v6" /></>,
                calendar: <><rect x="3" y="4" width="18" height="18" rx="2" ry="2" /><line x1="16" y1="2" x2="16" y2="6" /><line x1="8" y1="2" x2="8" y2="6" /><line x1="3" y1="10" x2="21" y2="10" /></>,
                location: <><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0118 0z" /><circle cx="12" cy="10" r="3" /></>,
                nose: <path d="M12 2c-3.31 0-6 2.69-6 6v10c0 1.1.9 2 2 2h8a2 2 0 002-2V8c0-3.31-2.69-6-6-6zM12 18c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2z" />,
                tongue: <path d="M12 22a9 9 0 009-9H3a9 9 0 009 9zM12 13v9" />,
                key: <><path d="M21 2l-2 2m-7.61 7.61a5.5 5.5 0 11-7.778 7.778 5.5 5.5 0 017.777-7.777zm0 0L15.5 7.5m0 0l3 3m-3-3l-2.5-2.5" /></>,
                quote: <path d="M3 21c3 0 7-1 7-8V5H3v8h4c0 5-4 6-4 6zm11 0c3 0 7-1 7-8V5h-7v8h4c0 5-4 6-4 6z" />
            };
            return (
                <div className={`icon-box ${className}`} style={{ width: size, height: size }}>
                    <svg viewBox="0 0 24 24" className="icon-svg">{icons[name] || null}</svg>
                </div>
            );
        };

        const App = () => {
            const [userApiKey, setUserApiKey] = useState(localStorage.getItem('WINE_DIARY_GEMINI_KEY') || '');
            const [showKeyModal, setShowKeyModal] = useState(!localStorage.getItem('WINE_DIARY_GEMINI_KEY'));
            const [tempKey, setTempKey] = useState('');

            const [wines, setWines] = useState([]);
            const [view, setView] = useState('dashboard');
            const [currentWine, setCurrentWine] = useState(null);
            const [searchTerm, setSearchTerm] = useState('');
            const [isScanning, setIsScanning] = useState(false);
            const [isLoading, setIsLoading] = useState(true);
            const [showDeleteConfirm, setShowDeleteConfirm] = useState(false);
            
            const backupFileRef = useRef(null);
            const fileInputRef = useRef(null);

            const activeKey = (userApiKey || apiKey).trim();

            useEffect(() => {
                const localData = localStorage.getItem('WINE_DIARY_STORAGE_V35_FINAL');
                if (localData) { try { setWines(JSON.parse(localData)); } catch (e) {} }
                setIsLoading(false);
            }, []);

            useEffect(() => {
                if (!isLoading) localStorage.setItem('WINE_DIARY_STORAGE_V35_FINAL', JSON.stringify(wines));
            }, [wines, isLoading]);

            const fetchGemini = async (prompt, isImage = false, base64 = null) => {
                if (!activeKey) { setShowKeyModal(true); return "{}"; }
                const url = `https://generativelanguage.googleapis.com/v1beta/models/${modelName}:generateContent?key=${activeKey}`;
                const parts = [{ text: prompt }];
                if (isImage && base64) {
                    const mimeType = base64.split(';')[0].split(':')[1];
                    const data = base64.split(',')[1];
                    parts.push({ inlineData: { mimeType, data } });
                }
                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: [{ role: "user", parts }] })
                });
                const text = await response.text();
                if (!response.ok) throw new Error(`API Error: ${response.status}`);
                const result = JSON.parse(text);
                return result.candidates?.[0]?.content?.parts?.[0]?.text ?? "{}";
            };

            const handleBackupExport = () => {
                const data = JSON.stringify(wines, null, 2);
                const blob = new Blob([data], {type: 'application/json'});
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url; a.download = `wine_diary_backup.json`; a.click();
            };

            const handleBackupImport = (e) => {
                const file = e.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = (event) => {
                    try {
                        const importedData = JSON.parse(event.target.result);
                        if (Array.isArray(importedData)) { setWines(importedData); alert("Restore Complete!"); }
                    } catch (err) { alert("Invalid file."); }
                };
                reader.readAsText(file);
                e.target.value = null;
            };

            const handleSaveKey = () => {
                if (tempKey.trim()) {
                    localStorage.setItem('WINE_DIARY_GEMINI_KEY', tempKey.trim());
                    setUserApiKey(tempKey.trim());
                    setShowKeyModal(false);
                }
            };

            const handlePasteKey = async () => {
                try {
                    const text = await navigator.clipboard.readText();
                    setTempKey(text);
                } catch (err) {}
            };

            const handleScan = async (base64) => {
                setIsScanning(true);
                try {
                    const prompt = `Analyze wine label. Return ONLY valid JSON. No markdown. Format: {"name":"", "producer":"", "vintage":"", "variety":"", "region":""}`;
                    const jsonText = await fetchGemini(prompt, true, base64);
                    const cleaned = jsonText.replace(/```json/g, "").replace(/```/g, "").trim();
                    const data = JSON.parse(cleaned);
                    setCurrentWine(prev => ({ ...(prev || {}), ...data, imageUrl: base64 }));
                } catch (e) { alert("Scan failed."); } finally { setIsScanning(false); }
            };

            const handleSave = () => {
                if (!currentWine?.name) return;
                if (currentWine.id) setWines(wines.map(w => w.id === currentWine.id ? currentWine : w));
                else setWines([{ ...currentWine, id: Date.now().toString(), createdAt: Date.now() }, ...wines]);
                setView('list');
            };

            const performDelete = () => {
                setWines(wines.filter(w => w.id !== currentWine.id));
                setShowDeleteConfirm(false);
                setView('list');
            };

            if (isLoading) return <div className="h-screen flex items-center justify-center bg-white"><div className="loader"></div></div>;

            return (
                <div className="min-h-screen bg-white">
                    {/* --- API Key Modal --- */}
                    {showKeyModal && (
                        <div className="modal-overlay">
                            <div className="w-full max-w-sm p-8 notion-block bg-white shadow-2xl space-y-6 text-left">
                                <div className="flex flex-col items-center gap-3 text-center">
                                    <NotionIcon name="key" size={48} />
                                    <h2 className="text-xl font-bold">API Key Setup</h2>
                                    <p className="text-[11px] text-stone-400 px-2 leading-relaxed text-center">Enter your Gemini API Key to enable AI Scanning.<br/>Saved locally on this device.</p>
                                </div>
                                <div className="space-y-3">
                                    <input className="notion-input" type="text" placeholder="Paste your key here..." value={tempKey} onChange={(e) => setTempKey(e.target.value)} />
                                    <button onClick={handlePasteKey} className="w-full py-3 bg-stone-50 text-[#2383E2] rounded-xl font-bold text-xs flex items-center justify-center gap-2 active:bg-stone-100 transition-colors">üìã Paste from Clipboard</button>
                                </div>
                                <button onClick={handleSaveKey} className="w-full py-4 bg-[#37352F] text-white rounded-xl font-bold active:scale-95 transition-all text-center">Start Journey</button>
                                <button onClick={() => setShowKeyModal(false)} className="w-full text-[10px] font-bold text-stone-300 uppercase tracking-widest text-center">Later</button>
                            </div>
                        </div>
                    )}

                    {/* --- Delete Confirm Modal --- */}
                    {showDeleteConfirm && (
                        <div className="modal-overlay">
                            <div className="w-full max-w-xs p-8 notion-block bg-white shadow-2xl space-y-6 text-center animate-in fade-in zoom-in duration-200">
                                <div className="flex flex-col items-center gap-4">
                                    <NotionIcon name="delete" size={48} />
                                    <div className="space-y-1">
                                        <h2 className="text-lg font-bold text-[#37352F]">Delete Record?</h2>
                                        <p className="text-xs text-stone-400 font-medium tracking-tight">This action cannot be undone.</p>
                                    </div>
                                </div>
                                <div className="grid grid-cols-2 gap-3 pt-2">
                                    <button onClick={() => setShowDeleteConfirm(false)} className="py-3 bg-stone-50 text-stone-500 rounded-xl font-bold text-xs active:bg-stone-100 transition-colors">Cancel</button>
                                    <button onClick={performDelete} className="py-3 bg-red-500 text-white rounded-xl font-bold text-xs active:bg-red-600 transition-all">Delete</button>
                                </div>
                            </div>
                        </div>
                    )}

                    <main className="max-w-md mx-auto px-6 pt-16 main-content">
                        {/* --- DASHBOARD --- */}
                        {view === 'dashboard' && (
                            <div className="space-y-12 animate-in fade-in">
                                <header className="space-y-2 text-left">
                                    <div className="flex items-center gap-3"><NotionIcon name="wine" size={36} /><h1 className="text-3xl font-bold tracking-tight text-[#37352F]">Wine Diary</h1></div>
                                    <p className="text-xs text-stone-400 font-bold uppercase tracking-[0.1em] ml-1">Archive for the aspiring wine lover.</p>
                                </header>
                                <div className="space-y-4">
                                    <div className="p-6 notion-block flex items-center justify-between shadow-sm">
                                        <div className="flex items-center gap-5 text-left">
                                            <div className="w-14 h-14 bg-stone-50 rounded-xl flex items-center justify-center shadow-inner"><NotionIcon name="wine" size={40} /></div>
                                            <div><p className="text-[10px] font-bold text-stone-400 uppercase tracking-widest mb-1 text-left">Cellar Size</p><p className="text-3xl font-bold text-[#37352F] text-left">{wines.length}</p></div>
                                        </div>
                                    </div>
                                    <div className="grid grid-cols-2 gap-4">
                                        <div onClick={() => setView('list')} className="p-6 notion-block cursor-pointer flex flex-col gap-4 active:bg-stone-50 transition-colors text-left"><NotionIcon name="book" size={32} /><span className="text-sm font-bold text-[#37352F] text-left">Archive Index</span></div>
                                        <div onClick={() => { if(wines.length > 0) { setCurrentWine(wines[0]); setView('detail'); }}} className="p-6 notion-block cursor-pointer flex flex-col gap-4 active:bg-stone-50 transition-colors text-left"><NotionIcon name="history" size={32} /><span className="text-sm font-bold text-[#37352F] text-left">Latest Entry</span></div>
                                    </div>
                                    <div onClick={() => { setCurrentWine({ name: '', producer: '', vintage: '', variety: '', region: '', type: 'Red', color: '', aromas: [], structure: { sweetness: 0, acidity: 0, tannin: 0, body: 0, finish: 0 }, date: new Date().toISOString().split('T')[0], rating: 5, comment: '', imageUrl: null }); setView('edit'); }} className="p-14 notion-block bg-[#F7F7F5] border-dashed border-2 cursor-pointer flex flex-col items-center justify-center gap-4 active:bg-stone-200 transition-colors text-center shadow-sm"><NotionIcon name="camera" size={56} /><p className="text-[11px] font-bold text-stone-500 uppercase tracking-widest text-center">New Page</p></div>
                                </div>
                                <div className="flex items-center justify-between pt-10 border-t border-stone-100 px-1">
                                    <h3 className="text-[10px] font-black text-stone-300 uppercase tracking-widest whitespace-nowrap">App Management</h3>
                                    <div className="flex items-center gap-4">
                                        <button onClick={() => setShowKeyModal(true)} className={`text-[10px] font-black uppercase tracking-widest px-2 py-1 rounded transition-colors ${activeKey ? 'text-[#2383E2] bg-blue-50' : 'text-stone-400 bg-stone-50'}`}>Key</button>
                                        <button onClick={handleBackupExport} className="text-[10px] font-bold text-stone-400 flex items-center gap-1 uppercase">Backup</button>
                                        <button onClick={() => backupFileRef.current.click()} className="text-[10px] font-bold text-stone-400 flex items-center gap-1 uppercase">Restore</button>
                                        <input type="file" ref={backupFileRef} className="hidden" accept=".json" onChange={handleBackupImport} />
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* --- LIST VIEW --- */}
                        {view === 'list' && (
                            <div className="space-y-8 animate-in fade-in text-left">
                                <header className="flex justify-between items-center px-1"><h2 className="text-2xl font-bold text-[#37352F] flex items-center gap-3"><NotionIcon name="archive" size={28} /> Archive</h2><button onClick={() => setView('dashboard')} className="text-xs font-bold text-stone-400 uppercase tracking-widest">Back</button></header>
                                <div className="relative"><div className="absolute left-4 top-1/2 -translate-y-1/2"><NotionIcon name="search" size={20} /></div><input className="notion-input pl-12" placeholder="Search archive..." value={searchTerm} onChange={e => setSearchTerm(e.target.value)} /></div>
                                <div className="divide-y divide-stone-100">
                                    {wines.filter(w => w.name.toLowerCase().includes(searchTerm.toLowerCase())).map((wine) => (
                                        <div key={wine.id} onClick={() => { setCurrentWine(wine); setView('detail'); }} className="py-5 flex items-center gap-5 cursor-pointer hover:bg-stone-50 px-2 transition-colors rounded-xl text-left">
                                            <div className="w-16 h-16 bg-stone-50 rounded-lg border border-stone-100 flex items-center justify-center overflow-hidden shrink-0">{wine.imageUrl ? <img src={wine.imageUrl} className="w-full h-full object-cover" /> : <NotionIcon name="wine" size={32} />}</div>
                                            <div className="flex-1 min-w-0 text-left"><p className="text-base font-bold text-[#37352F] truncate">{wine.name}</p><p className="text-xs text-stone-400 font-medium truncate uppercase">{wine.variety} ¬∑ {wine.vintage || 'NV'}</p></div>
                                            <div className="flex items-center gap-1.5 px-2 py-1 bg-stone-50 rounded-md"><NotionIcon name="star" size={14} /><span className="text-xs font-bold text-[#37352F]">{wine.rating}</span></div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        {/* --- DETAIL VIEW --- */}
                        {view === 'detail' && currentWine && (
                            <div className="space-y-10 animate-in fade-in pb-10 text-left">
                                <header className="flex justify-between items-center px-1">
                                    <button onClick={() => setView('list')} className="text-xs font-bold text-[#2383E2] flex items-center gap-3 uppercase tracking-widest hover:underline tracking-widest">Index</button>
                                    <div className="flex gap-6">
                                        <div className="cursor-pointer" onClick={() => setView('edit')}><NotionIcon name="edit" size={28} /></div>
                                        <div className="cursor-pointer" onClick={() => setShowDeleteConfirm(true)}><NotionIcon name="delete" size={28} /></div>
                                    </div>
                                </header>
                                <div className="space-y-12">
                                    <div className="w-full aspect-square bg-stone-50 rounded-3xl overflow-hidden border border-stone-100 shadow-sm">{currentWine.imageUrl ? <img src={currentWine.imageUrl} className="w-full h-full object-cover" /> : <div className="w-full h-full flex items-center justify-center bg-stone-50"><NotionIcon name="wine" size={100} /></div>}</div>
                                    <div className="space-y-2 px-1 text-left">
                                        <div className="flex items-center gap-2 mb-1"><span className={`px-2 py-0.5 rounded text-[10px] font-bold text-white ${currentWine.type === 'Red' ? 'bg-red-500' : 'bg-blue-400'}`}>{currentWine.type}</span><span className="text-[10px] font-bold text-stone-300 uppercase">{currentWine.color}</span></div>
                                        <h2 className="text-4xl font-bold leading-tight text-[#37352F]">{currentWine.name}</h2>
                                        <p className="text-lg text-stone-400 font-medium">{currentWine.producer || 'Unknown'}</p>
                                    </div>
                                    <div className="border-y border-stone-100 divide-y divide-stone-100 px-1 text-left">
                                        {[ { label: 'Date', icon: 'calendar', value: currentWine.date }, { label: 'Region', icon: 'location', value: currentWine.region || '-' } ].map((item, idx) => (
                                            <div key={idx} className="flex items-center py-5"><div className="w-36 text-[11px] font-black text-stone-400 uppercase tracking-widest flex items-center gap-3"><NotionIcon name={item.icon} size={22} /> {item.label}</div><div className={`flex-1 text-sm font-semibold text-[#37352F]`}>{item.value}</div></div>
                                        ))}
                                        <div className="py-5 text-left"><div className="text-[11px] font-black text-stone-400 uppercase tracking-widest flex items-center gap-3 mb-3 text-left"><NotionIcon name="nose" size={22} /> Aroma Profile</div><div className="flex flex-wrap gap-2 text-left">{currentWine.aromas?.length > 0 ? currentWine.aromas.map(a => <span key={a} className="px-3 py-1 bg-stone-100 text-[#37352F] text-[11px] font-bold rounded-full">{a}</span>) : <span className="text-stone-300 text-[11px] italic">No aromas recorded.</span>}</div></div>
                                        <div className="py-5 text-left"><div className="text-[11px] font-black text-stone-400 uppercase tracking-widest flex items-center gap-3 mb-4 text-left"><NotionIcon name="tongue" size={22} /> Palate & Structure</div><div className="grid grid-cols-2 gap-x-8 gap-y-4 text-left text-left">{STRUCTURE_CONFIG.map(s => (<div key={s.id} className="flex justify-between items-center text-[13px] text-left"><span className="text-stone-400 font-bold uppercase tracking-tighter">{s.label}</span><span className="font-bold text-[#37352F]">{currentWine.structure?.[s.id] !== undefined ? s.levels[currentWine.structure[s.id]] : 'Med'}</span></div>))}</div></div>
                                    </div>
                                    <div className="p-8 bg-[#F7F7F5] rounded-3xl border border-stone-100 relative overflow-hidden text-left"><div className="absolute -top-4 -right-4 opacity-10"><NotionIcon name="quote" size={100} /></div><p className="text-lg leading-relaxed text-stone-700 font-medium italic relative z-10 text-left">"{currentWine.comment || 'No tasting notes provided.'}"</p></div>
                                </div>
                            </div>
                        )}

                        {/* --- EDIT VIEW --- */}
                        {view === 'edit' && currentWine && (
                            <div className="space-y-6 animate-in fade-in pb-24 text-left">
                                <div className="space-y-6 px-1 pt-2">
                                    <div onClick={() => fileInputRef.current?.click()} className="w-full aspect-[4/3] bg-stone-50 border-2 border-dashed border-stone-200 rounded-3xl flex flex-col items-center justify-center cursor-pointer overflow-hidden relative group text-center shadow-sm">
                                        {currentWine.imageUrl ? <img src={currentWine.imageUrl} className="w-full h-full object-cover" /> : <><NotionIcon name="camera" size={64} className="mb-4" /><p className="text-[10px] font-bold text-stone-400 uppercase tracking-widest text-center">Scan label</p></>}
                                        {isScanning && <div className="absolute inset-0 bg-white/90 backdrop-blur-sm flex flex-col items-center justify-center z-20"><div className="loader"></div></div>}
                                        <input type="file" accept="image/*" className="hidden" ref={fileInputRef} onChange={e => { const f = e.target.files[0]; if(f) { const r = new FileReader(); r.onloadend = () => handleScan(r.result); r.readAsDataURL(f); } }} />
                                    </div>
                                    <div className="space-y-6">
                                        <div className="space-y-2 text-left"><label className="text-[10px] font-black text-stone-400 uppercase tracking-widest ml-1 text-left">Wine Name</label><input className="notion-input font-bold text-lg text-[#37352F]" value={currentWine.name} onChange={e => setCurrentWine({...currentWine, name: e.target.value})} placeholder="Title..." /></div>
                                        <div className="grid grid-cols-2 gap-4 text-left">
                                            <div className="space-y-2 text-left"><label className="text-[10px] font-black text-stone-400 uppercase tracking-widest ml-1 text-left">Year</label><input className="notion-input" value={currentWine.vintage} onChange={e => setCurrentWine({...currentWine, vintage: e.target.value})} placeholder="Vintage" /></div>
                                            <div className="space-y-2 text-left"><label className="text-[10px] font-black text-stone-400 uppercase tracking-widest ml-1 text-left">Grape</label><input className="notion-input" value={currentWine.variety} onChange={e => setCurrentWine({...currentWine, variety: e.target.value})} placeholder="Grape" /></div>
                                        </div>
                                    </div>
                                    <div className="space-y-6 pt-4 border-t border-stone-100 text-left">
                                        <div className="flex justify-between items-end text-left"><label className="text-[10px] font-black text-stone-400 uppercase tracking-widest ml-1">Type & Color</label><select className="text-[11px] font-bold text-stone-400 bg-transparent outline-none" value={currentWine.type} onChange={e => setCurrentWine({...currentWine, type: e.target.value, color: ''})}>{WINE_TYPES.map(t => <option key={t} value={t}>{t} Wine</option>)}</select></div>
                                        <div className="flex flex-wrap gap-2 text-left">{COLOR_MAP[currentWine.type].map(c => (<button key={c} onClick={() => setCurrentWine({...currentWine, color: c})} className={`px-4 py-2 rounded-full text-xs font-bold border transition-all ${currentWine.color === c ? 'bg-[#37352F] text-white border-[#37352F]' : 'bg-white text-stone-400 border-stone-100'}`}>{c}</button>))}</div>
                                    </div>
                                    <div className="space-y-6 pt-4 border-t border-stone-100 text-left">
                                        <label className="text-[10px] font-black text-stone-400 uppercase tracking-widest ml-1">Aroma Profile</label>
                                        {Object.entries(AROMA_CATEGORIES).map(([cat, items]) => (
                                            <div key={cat} className="space-y-2 text-left">
                                                <p className="text-[10px] font-bold text-stone-300 italic px-1 text-left">{cat}</p>
                                                <div className="flex flex-wrap gap-2 text-left">{items.map(item => (<button key={item} onClick={() => { const aroms = currentWine.aromas || []; setCurrentWine({...currentWine, aromas: aroms.includes(item) ? aroms.filter(a => a !== item) : [...aroms, item]}); }} className={`px-3 py-1.5 rounded-lg text-xs font-bold border transition-all ${currentWine.aromas?.includes(item) ? 'bg-blue-50 text-[#2383E2] border-[#2383E2]' : 'bg-white text-stone-400 border-stone-50'}`}>{item}</button>))}</div>
                                            </div>
                                        ))}
                                    </div>
                                    <div className="space-y-8 pt-4 border-t border-stone-100 text-left"><label className="text-[10px] font-black text-stone-400 uppercase tracking-widest ml-1 text-left">Palate & Structure</label>{STRUCTURE_CONFIG.map(s => (<div key={s.id} className="space-y-2 text-left text-left"><div className="flex justify-between text-[10px] font-bold"><span className="text-stone-400 uppercase">{s.label}</span><span className="text-[#2383E2]">{currentWine.structure?.[s.id] !== undefined ? s.levels[currentWine.structure[s.id]] : 'Med'}</span></div><div className="flex gap-1 bg-stone-50 p-1 rounded-xl text-left">{s.levels.map((level, idx) => (<button key={level} onClick={() => setCurrentWine({...currentWine, structure: {...(currentWine.structure || {}), [s.id]: idx}})} className={`flex-1 py-2 text-[10px] font-bold rounded-lg transition-all ${currentWine.structure?.[s.id] === idx ? 'bg-white text-[#37352F] shadow-sm' : 'text-stone-300'}`}>{idx + 1}</button>))}</div></div>))}</div>
                                    <div className="space-y-3 pt-4 border-t border-stone-100 text-left"><label className="text-[10px] font-black text-stone-400 uppercase tracking-widest ml-1 text-left">Note</label><textarea className="notion-input h-32 resize-none text-base leading-relaxed" value={currentWine.comment} onChange={e => setCurrentWine({...currentWine, comment: e.target.value})} placeholder="Experience..." /></div>
                                    <div className="space-y-4 pt-4 text-left"><div className="flex justify-between items-center px-1"><span className="text-[10px] font-black text-stone-400 uppercase tracking-widest">Star Rating</span><span className="text-xl font-bold text-[#37352F]">{currentWine.rating}/10</span></div><div className="flex gap-1.5 text-left text-left">{[...Array(10)].map((_, i) => <button key={i} onClick={() => setCurrentWine({...currentWine, rating: i+1})} className={`flex-1 h-10 rounded-lg transition-all ${currentWine.rating >= i+1 ? 'bg-[#37352F]' : 'bg-stone-100'} active:scale-90`} />)}</div></div>
                                    <button onClick={handleSave} className="w-full py-6 bg-[#37352F] text-white rounded-2xl font-bold text-xl active:bg-black transition-colors shadow-xl text-center">Archive Record</button>
                                    <button onClick={() => setView('dashboard')} className="w-full py-4 text-stone-300 text-xs font-bold uppercase tracking-widest text-center">Cancel Recording</button>
                                </div>
                            </div>
                        )}
                    </main>

                    {/* ‚ú® ÌïòÎã® Ï†ïÎ≥¥ Ìà¨Í≥º Î∞©ÏßÄ Í∞ÄÎ¶ºÎßâ */}
                    <div className="bottom-nav-mask"></div>

                    {/* ‚ú® ÌïòÎã® ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò Î∞î (FITTED & CENTERED LAYOUT) */}
                    <nav className="fixed bottom-6 left-1/2 -translate-x-1/2 z-50 flex justify-center w-full px-4 pointer-events-none">
                        <div className="bg-white/95 backdrop-blur-md border border-stone-200 px-8 py-3 rounded-full flex items-center justify-center gap-10 shadow-2xl pointer-events-auto min-h-[64px]">
                            <button onClick={() => setView('dashboard')} className={`active:opacity-50 transition-opacity flex items-center justify-center p-1 ${view === 'dashboard' ? 'text-[#37352F]' : 'text-stone-300'}`}>
                                <NotionIcon name="home" size={32} />
                            </button>
                            <button onClick={() => setView('list')} className={`active:opacity-50 transition-opacity flex items-center justify-center p-1 ${view === 'list' ? 'text-[#37352F]' : 'text-stone-300'}`}>
                                <NotionIcon name="archive" size={32} />
                            </button>
                            <div className="w-[1px] h-6 bg-stone-200 mx-1" />
                            <button 
                                onClick={() => { setCurrentWine({ name: '', producer: '', vintage: '', variety: '', region: '', type: 'Red', color: '', aromas: [], structure: { sweetness: 0, acidity: 0, tannin: 0, body: 0, finish: 0 }, date: new Date().toISOString().split('T')[0], rating: 5, comment: '', imageUrl: null }); setView('edit'); }} 
                                className="active:opacity-50 transition-opacity flex items-center justify-center p-1 text-stone-400"
                            >
                                <NotionIcon name="add" size={32} />
                            </button>
                        </div>
                    </nav>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
